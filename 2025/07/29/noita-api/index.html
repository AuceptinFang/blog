<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>noita_api | Auceptin's Blog</title><meta name="author" content="Auceptin.Fang"><meta name="copyright" content="Auceptin.Fang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="一个 noita API使用参考文档  noita的api只提供了参数和返回值，并没有详细效果，noita wiki里也没有看到详细说明，故写本文 lua_api_documentation.txt文件版本：Current modding API version: 12，共注明了405个，其中16个注明deprecated，本文忽略,当前进度：53&#x2F;389 开销测量因环境与上下文而异，仅供参考">
<meta property="og:type" content="article">
<meta property="og:title" content="noita_api">
<meta property="og:url" content="https://aucept.in/2025/07/29/noita-api/index.html">
<meta property="og:site_name" content="Auceptin&#39;s Blog">
<meta property="og:description" content="一个 noita API使用参考文档  noita的api只提供了参数和返回值，并没有详细效果，noita wiki里也没有看到详细说明，故写本文 lua_api_documentation.txt文件版本：Current modding API version: 12，共注明了405个，其中16个注明deprecated，本文忽略,当前进度：53&#x2F;389 开销测量因环境与上下文而异，仅供参考">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://aucept.in/image/cover25_sunshine.jpg">
<meta property="article:published_time" content="2025-07-29T09:00:00.000Z">
<meta property="article:modified_time" content="2025-07-31T03:15:16.427Z">
<meta property="article:author" content="Auceptin.Fang">
<meta property="article:tag" content="lua">
<meta property="article:tag" content="noita">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aucept.in/image/cover25_sunshine.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "noita_api",
  "url": "https://aucept.in/2025/07/29/noita-api/",
  "image": "https://aucept.in/image/cover25_sunshine.jpg",
  "datePublished": "2025-07-29T09:00:00.000Z",
  "dateModified": "2025-07-31T03:15:16.427Z",
  "author": [
    {
      "@type": "Person",
      "name": "Auceptin.Fang",
      "url": "https://aucept.in/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://aucept.in/2025/07/29/noita-api/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'noita_api',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><style>
  /* 数学公式美化样式 */
  .MathJax_Display {
    margin: 1.5em 0 !important;
    text-align: center !important;
  }
  
  .MathJax {
    font-size: 1.1em !important;
  }
  
  /* 行内公式样式 */
  .MathJax_Preview {
    color: inherit;
  }
  
  /* 块级公式容器美化 */
  .MathJax_Display {
    background: rgba(0,0,0,0.02);
    border-radius: 8px;
    padding: 15px 20px;
    margin: 20px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-left: 4px solid #49b1f5;
  }
  
  /* 暗色模式下的公式样式 */
  [data-theme="dark"] .MathJax_Display {
    background: rgba(255,255,255,0.05);
    border-left-color: #1f2937;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
  
  /* 公式编号样式 */
  .MathJax .mjx-math .mjx-mrow .mjx-mtable .mjx-label {
    color: #666;
    font-size: 0.9em;
  }
  
  /* 提升公式清晰度 */
  .MathJax svg {
    max-width: 100% !important;
    height: auto !important;
  }
</style>
<meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-color: #f5f5f5;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/auceptin-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/friends/"><span> Friends</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/image/cover2_square.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Auceptin's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">noita_api</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/friends/"><span> Friends</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">noita_api</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-29T09:00:00.000Z" title="发表于 2025-07-29 17:00:00">2025-07-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-31T03:15:16.427Z" title="更新于 2025-07-31 11:15:16">2025-07-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/noita/">noita</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p><span style = "font-size: 30px; font-weight: 900">一个 noita API使用参考文档 </span></p>
<p>noita的api只提供了参数和返回值，并没有详细效果，noita wiki里也没有看到详细说明，故写本文</p>
<p>lua_api_documentation.txt文件版本：<code>Current modding API version: 12</code>，共注明了405个，其中16个注明deprecated，本文忽略,当前进度：53/389</p>
<div class="note danger flat"><p>开销测量因环境与上下文而异，仅供参考</p>
</div>
<h2 id="调试相关"><a href="#调试相关" class="headerlink" title="调试相关"></a>调试相关</h2><h3 id="GamePrint"><a href="#GamePrint" class="headerlink" title="GamePrint"></a><code>GamePrint</code></h3><blockquote>
<p>GamePrint( log_line:string )</p>
</blockquote>
<p>参数是一个字符串（数字也可以），效果为在游戏左下角输出，测得开销约为0.9秒/百万次。noita每秒60帧，也就是每帧16毫秒，不到20000次输出</p>
<p>属于比较轻量的输出，每帧调用几千次不会造成明显影响</p>
<h3 id="GamePrintImportant"><a href="#GamePrintImportant" class="headerlink" title="GamePrintImportant"></a><code>GamePrintImportant</code></h3><blockquote>
<p>GamePrintImportant( title:string, description:string = “”, ui_custom_decoration_file:string = “” )</p>
</blockquote>
<p>三个字符串参数，标题、描述和ui装饰</p>
<p>第一个显示在框里，触怒神明等，第二个显示在框下，第三个改变框的ui，默认为触怒神明时的那种，需要一个图片的路径，如：”data/ui_gfx/decorations/3piece_fungal_shift.png”可以换为真菌转化的ui</p>
<p>有几秒的固定持续时间，不会被后来的覆盖掉，超出一定时间限制的会被丢弃</p>
<h3 id="GameGetRealWorldTimeSinceStarted"><a href="#GameGetRealWorldTimeSinceStarted" class="headerlink" title="GameGetRealWorldTimeSinceStarted()"></a><code>GameGetRealWorldTimeSinceStarted()</code></h3><blockquote>
<p>GameGetRealWorldTimeSinceStarted() -&gt; number</p>
</blockquote>
<p>返回自游戏开始的时间，单位是秒，小数点后保留7位</p>
<h3 id="GameGetFrameNum"><a href="#GameGetFrameNum" class="headerlink" title="GameGetFrameNum"></a><code>GameGetFrameNum</code></h3><blockquote>
<p>GameGetFrameNum() -&gt; int</p>
</blockquote>
<p>返回一个整数，游戏开始到当前的帧数（每秒上限60帧）</p>
<h3 id="GameGetDateAndTimeUTC"><a href="#GameGetDateAndTimeUTC" class="headerlink" title="GameGetDateAndTimeUTC"></a><code>GameGetDateAndTimeUTC</code></h3><blockquote>
<p>GameGetDateAndTimeUTC() -&gt; year:int,month:int,day:int,hour:int,minute:int,second:int</p>
</blockquote>
<p>返回六个整数，获取UTC日期时间</p>
<h3 id="GameGetDateAndTimeLocal"><a href="#GameGetDateAndTimeLocal" class="headerlink" title="GameGetDateAndTimeLocal"></a><code>GameGetDateAndTimeLocal</code></h3><blockquote>
<p>GameGetDateAndTimeLocal() -&gt;year:int,month:int,day:int,hour:int,minute:int,second:int</p>
</blockquote>
<p>同上，获取本地时间</p>
<h3 id="SetTimeOut"><a href="#SetTimeOut" class="headerlink" title="SetTimeOut"></a><code>SetTimeOut</code></h3><blockquote>
<p>SetTimeOut( time_to_execute:number, file_to_execute:string, function_to_call:string = nil )</p>
</blockquote>
<p>%rdi秒后执行，参数为：时间（秒），文件路径（绝对路径），要执行的文件里的函数名</p>
<p>使用参考：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetTimeOut( <span class="number">0.54</span>, <span class="string">&quot;data/scripts/buildings/egg_damage.lua&quot;</span>, <span class="string">&quot;impl_spawn_boss_dragon&quot;</span>)</span><br></pre></td></tr></table></figure><br>注：此函数运行是非阻塞的，即执行到该函数时开始计时并立刻返回，计时完成后执行函数</p>
<h3 id="SetWorldSeed"><a href="#SetWorldSeed" class="headerlink" title="SetWorldSeed"></a><code>SetWorldSeed</code></h3><blockquote>
<p>SetWorldSeed( new_seed:int )</p>
</blockquote>
<p>设置世界的种子</p>
<h3 id="Random"><a href="#Random" class="headerlink" title="Random"></a><code>Random</code></h3><blockquote>
<p>Random( a:int = optional, b:int = optional ) -&gt; number|int. [This is kinda messy. If given 0 arguments, returns number between 0.0 and 1.0. If given 1 arguments, returns int between 0 and ‘a’. If given 2 arguments returns int between ‘a’ and ‘b’.]</p>
</blockquote>
<p>生成随机整数，没有参数返回值范围是0~1，一个参数是0~a，两个参数是a~b</p>
<h3 id="Randomf"><a href="#Randomf" class="headerlink" title="Randomf"></a><code>Randomf</code></h3><blockquote>
<p>Randomf( min:number = optional, max:number = optional ) -&gt; number [This is kinda messy. If given 0 arguments, returns number between 0.0 and 1.0. If given 1 arguments, returns number between 0.0 and ‘a’. If given 2 arguments returns number between ‘a’ and ‘b’.]</p>
</blockquote>
<p>生成随机数，范围同Random</p>
<h2 id="Entity……"><a href="#Entity……" class="headerlink" title="Entity……"></a>Entity……</h2><h3 id="EntityLoad"><a href="#EntityLoad" class="headerlink" title="EntityLoad"></a><code>EntityLoad</code></h3><blockquote>
<p>EntityLoad( filename:string, pos_x:number = 0, pos_y:number = 0 ) -&gt; entity_id:int</p>
</blockquote>
<p>生成一个实体，参数为一个xml文件路径和两个坐标，返回entity_id，实体的标识符，可以以此跟踪该实体</p>
<p>生成开销（每百次毫秒级）远小于后续计算实体行为开销</p>
<p>生物数量有上限，超出会删掉旧的</p>
<h3 id="EntityLoadEndGameItem"><a href="#EntityLoadEndGameItem" class="headerlink" title="EntityLoadEndGameItem"></a><code>EntityLoadEndGameItem</code></h3><blockquote>
<p>EntityLoadEndGameItem( filename:string, pos_x:number = 0, pos_y:number = 0 ) -&gt; entity_id:int</p>
</blockquote>
<p>一个很神秘的api，测试中和EntityLoad基本一致，游戏中唯一可见的用法是：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( Random( <span class="number">0</span>, <span class="number">100000</span>) &gt;= <span class="number">100000</span> ) <span class="keyword">then</span></span><br><span class="line">	EntityLoadEndGameItem( <span class="string">&quot;data/entities/animals/boss_centipede/sampo.xml&quot;</span>, x, y )</span><br><span class="line">	count = <span class="number">0</span></span><br><span class="line">	<span class="keyword">return</span> </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><br>该函数效果是会在正常生成sampo之后再生成一个宝箱</p>
<h3 id="EntityKill"><a href="#EntityKill" class="headerlink" title="EntityKill"></a><code>EntityKill</code></h3><blockquote>
<p>EntityKill( entity_id:int )</p>
</blockquote>
<p>清除指定id的实体，无尸体、无掉落</p>
<h3 id="EntityCreateNew"><a href="#EntityCreateNew" class="headerlink" title="EntityCreateNew"></a><code>EntityCreateNew</code></h3><blockquote>
<p>EntityCreateNew( name:string = “” ) -&gt; entity_id:int</p>
</blockquote>
<p>创建一个实体，参数为实体名，可留空，返回id，搭配其它操作实体的函数使用，例：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- add ui icon etc</span></span><br><span class="line"><span class="keyword">local</span> entity_ui = EntityCreateNew( <span class="string">&quot;&quot;</span> )</span><br><span class="line">EntityAddComponent( entity_ui, <span class="string">&quot;UIIconComponent&quot;</span>, </span><br><span class="line">&#123; </span><br><span class="line">	name = essence_name,</span><br><span class="line">	description = essence_desc,</span><br><span class="line">	icon_sprite_file = ui_icon</span><br><span class="line">&#125;)</span><br><span class="line">EntityAddTag( entity_ui, <span class="string">&quot;essence_effect&quot;</span> )</span><br><span class="line">EntityAddChild( entity_who_picked, entity_ui )</span><br></pre></td></tr></table></figure></p>
<h3 id="EntityLoadCameraBound"><a href="#EntityLoadCameraBound" class="headerlink" title="EntityLoadCameraBound"></a><code>EntityLoadCameraBound</code></h3><blockquote>
<p>EntityLoadCameraBound( filename:string, pos_x:number = 0, pos_y:number = 0 )</p>
</blockquote>
<p>输入一个xml路径，一对坐标，不返回实体id。在对应坐标处生成一个指定实体，除无返回值外未观察到与EntityLoad的区别，开销相近，游戏文件中不常见</p>
<h3 id="EntityGetWithTag"><a href="#EntityGetWithTag" class="headerlink" title="EntityGetWithTag"></a><code>EntityGetWithTag</code></h3><blockquote>
<p>EntityGetWithTag( tag:string ) -&gt; {entity_id:int} <strong>[Returns all entities with ‘tag’.]</strong></p>
</blockquote>
<p>获取带有指定标签的实体，参数是标签，nolla备注说返回的是所有实体（id）</p>
<p>tags可以在实体的xml文件里看到：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Entity</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">name</span>=<span class="string">&quot;DEBUG_NAME:player&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">tags</span>=<span class="string">&quot;mortal,human,hittable,peasant,prey,player_unit,teleportable&quot;</span> &gt;</span></span><br></pre></td></tr></table></figure><br>寻找玩家就可以：</p>
<blockquote>
<p>EntityGetWithTag( “player_unit” )</p>
</blockquote>
<p>有一定的检测范围，大于视野很多</p>
<h3 id="EntityGetInRadius"><a href="#EntityGetInRadius" class="headerlink" title="EntityGetInRadius"></a><code>EntityGetInRadius</code></h3><blockquote>
<p>EntityGetInRadius( pos_x:number, pos_y:number, radius:number ) -&gt; {entity_id:int} [Returns all entities in ‘radius’ distance from ‘x’,’y’.]</p>
</blockquote>
<p>输入坐标和半径，返回所有实体id。检测范围存在上限，半径约为1000像素（有待精确测量）</p>
<h3 id="EntityGetInRadiusWithTag"><a href="#EntityGetInRadiusWithTag" class="headerlink" title="EntityGetInRadiusWithTag"></a><code>EntityGetInRadiusWithTag</code></h3><blockquote>
<p>EntityGetInRadiusWithTag( pos_x:number, pos_y:number, radius:number, entity_tag:string ) -&gt; {entity_id:int} [Returns all entities in ‘radius’ distance from ‘x’,’y’.]</p>
</blockquote>
<p>输入一对坐标，实体id和一个标签，前两个的结合</p>
<h3 id="EntityGetClosest"><a href="#EntityGetClosest" class="headerlink" title="EntityGetClosest"></a><code>EntityGetClosest</code></h3><blockquote>
<p>EntityGetClosest( pos_x:number, pos_y:number ) -&gt; entity_id:int</p>
</blockquote>
<p>获取具体给定坐标最近的实体id，输入一对坐标，返回id</p>
<h3 id="EntityGetClosestWithTag"><a href="#EntityGetClosestWithTag" class="headerlink" title="EntityGetClosestWithTag"></a><code>EntityGetClosestWithTag</code></h3><blockquote>
<p>EntityGetClosestWithTag(  pos_x:number, pos_y:number, tag:string ) -&gt; entity_id:int</p>
</blockquote>
<p>获取最近的带有某标签的实体，输入坐标、标签，返回id</p>
<h3 id="EntityGetWithName"><a href="#EntityGetWithName" class="headerlink" title="EntityGetWithName"></a><code>EntityGetWithName</code></h3><blockquote>
<p>EntityGetWithName( name:string ) -&gt; entity_id:int</p>
</blockquote>
<p>输入name，返回id。name类似于以下，是实体的名字，受汉化影响。（此api在游戏文件里一次也没用过）<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Entity</span> <span class="attr">name</span>=<span class="string">&quot;$projectile_default&quot;</span> <span class="attr">tags</span>=<span class="string">&quot;projectile_player&quot;</span> &gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="EntityGetTransform"><a href="#EntityGetTransform" class="headerlink" title="EntityGetTransform"></a><code>EntityGetTransform</code></h3><blockquote>
<p>EntityGetTransform( entity_id:int ) -&gt; x:number,y:number,rotation:number,scale_x:number,scale_y:number</p>
</blockquote>
<p>用于获取实体位置，输入实体id</p>
<p>前俩返回值是坐标，rotation是贴图的旋转角度，单位是弧度，0为正，顺时针，scale_x和y是贴图的缩放倍数，负数为翻转</p>
<h3 id="EntitySetTransform"><a href="#EntitySetTransform" class="headerlink" title="EntitySetTransform"></a><code>EntitySetTransform</code></h3><blockquote>
<p>EntitySetTransform( entity_id:int, x:number, y:number = 0, rotation:number = 0, scale_x:number = 1, scale_y:number = 1 )</p>
</blockquote>
<p>设置实体状态，id，坐标，贴图顺时针选择弧度，贴图缩放，-1翻转</p>
<h3 id="EntityApplyTransform"><a href="#EntityApplyTransform" class="headerlink" title="EntityApplyTransform"></a><code>EntityApplyTransform</code></h3><blockquote>
<p>EntityApplyTransform( entity_id:int, x:number, y:number = 0, rotation:number = 0, scale_x:number = 1, scale_y:number = 1 )  [Sets the transform and tries to immediately refresh components that calculate values based on an entity’s transform.]</p>
</blockquote>
<p>用法同上，立即更新依赖组件</p>
<h3 id="EntityGetName"><a href="#EntityGetName" class="headerlink" title="EntityGetName"></a><code>EntityGetName</code></h3><blockquote>
<p>EntityGetName( entity_id:int ) -&gt; name:string</p>
</blockquote>
<p>输入id，返回name（字符串）</p>
<h3 id="EntitySetName"><a href="#EntitySetName" class="headerlink" title="EntitySetName"></a><code>EntitySetName</code></h3><blockquote>
<p>EntitySetName( entity_id:int, name:string )</p>
</blockquote>
<p>输入id和name，无返回值</p>
<h3 id="EntityGetTags"><a href="#EntityGetTags" class="headerlink" title="EntityGetTags"></a><code>EntityGetTags</code></h3><blockquote>
<p>EntityGetTags( entity_id:int ) -&gt; string|nil [Returns a string where the tags are comma-separated, or nil if ‘entity_id’ doesn’t point to a valid entity.]</p>
</blockquote>
<p>输入id，返回标签（一个字符串）。备注说返回的标签以字符串分割，id无效返回nil</p>
<h3 id="EntityAddTag"><a href="#EntityAddTag" class="headerlink" title="EntityAddTag"></a><code>EntityAddTag</code></h3><blockquote>
<p>EntityAddTag( entity_id:int, tag:string )</p>
</blockquote>
<p>输入实体id，字符串，追加到原有标签末尾</p>
<h3 id="EntityRemoveTag"><a href="#EntityRemoveTag" class="headerlink" title="EntityRemoveTag"></a><code>EntityRemoveTag</code></h3><blockquote>
<p>EntityRemoveTag( entity_id:int, tag:string )</p>
</blockquote>
<p>移除标签，输入实体id，待移除的标签名</p>
<h3 id="EntityHasTag"><a href="#EntityHasTag" class="headerlink" title="EntityHasTag"></a><code>EntityHasTag</code></h3><blockquote>
<p>EntityHasTag( entity_id:int, tag:string ) -&gt; bool</p>
</blockquote>
<p>判断实体是否具有标签，返回一个bool值</p>
<h3 id="EntityGetFilename"><a href="#EntityGetFilename" class="headerlink" title="EntityGetFilename"></a><code>EntityGetFilename</code></h3><blockquote>
<p>EntityGetFilename( entity_id:int ) -&gt; full_path:string [Return value example: ‘data/entities/items/flute.xml’. Incorrect value is returned if the entity has passed through the world streaming system.]</p>
</blockquote>
<p>输入id，返回一个文件路径名</p>
<h3 id="EntitiesGetMaxID"><a href="#EntitiesGetMaxID" class="headerlink" title="EntitiesGetMaxID"></a><code>EntitiesGetMaxID</code></h3><blockquote>
<p>EntitiesGetMaxID() -&gt; entity_max_id:number [Returns the max entity ID currently in use. Entity IDs are increased linearly. ]</p>
</blockquote>
<p>无参数，返回在用的最大id</p>
<h3 id="EntityGetIsAlive"><a href="#EntityGetIsAlive" class="headerlink" title="EntityGetIsAlive"></a><code>EntityGetIsAlive</code></h3><blockquote>
<p>EntityGetIsAlive( entity_id:int ) -&gt; bool</p>
</blockquote>
<p>输入实体id，返回bool值，是否活着</p>
<h3 id="EntityAddComponent"><a href="#EntityAddComponent" class="headerlink" title="EntityAddComponent"></a><code>EntityAddComponent</code></h3><blockquote>
<p>EntityAddComponent( entity_id:int, component_type_name:string, table_of_component_values:{string} = nil ) -&gt; component_id:int</p>
</blockquote>
<p>为实体增加组件，输入实体id，组件名，一个该组件的属性表（键值对），返回组件id（唯一地标识该实体的改组件）</p>
<p>使用参考：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EntityAddComponent( projectile_id, <span class="string">&quot;HomingComponent&quot;</span>, </span><br><span class="line">	&#123; </span><br><span class="line">		target_tag = <span class="string">&quot;projectile_commander&quot;</span>,</span><br><span class="line">		homing_targeting_coeff = <span class="string">&quot;200&quot;</span>,</span><br><span class="line">		homing_velocity_multiplier = <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="EntityAddComponent2"><a href="#EntityAddComponent2" class="headerlink" title="EntityAddComponent2"></a><code>EntityAddComponent2</code></h3><blockquote>
<p>EntityAddComponent2( entity_id:int, component_type_name, table_of_component_values:{string-multiple_types} = nil ) -&gt; component_id [Creates a component of type ‘component_type_name’ and adds it to ‘entity_id’. ‘table_of_component_values’ should be a string-indexed table, where keys are field names and values are field values of correct type. The value setting works like ComponentObjectSetValue2(), with the exception that multivalue types are not supported. Additional supported values are _tags:comma_separated_string and _enabled:bool, which basically work like the those fields work in entity XML files. Returns the created component, if creation succeeded, or nil.</p>
</blockquote>
<p>参数与返回值同上，nolla备注说：创造一个组件并加到实体上，组件值表应该是一个键值对表，键是字段名，值是正确的类型。这个值设置运行就像ComponentObjectSetValue2()一样，除了不支持多种值类型。额外支持的值有_tags:comma_separated_string和 _enabled:bool，和其他xml文件里对应的字段效果一样</p>
<p>并没有解释和EntityAddComponent相比有什么区别，使用示例：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">EntityAddComponent2( text_id, <span class="string">&quot;SpriteComponent&quot;</span>,</span><br><span class="line">		&#123;</span><br><span class="line">			image_file=<span class="string">&quot;data/fonts/font_pixel_white.xml&quot;</span>,</span><br><span class="line">			is_text_sprite=<span class="literal">true</span>,</span><br><span class="line">			offset_x=<span class="number">12</span>,</span><br><span class="line">			offset_y=<span class="number">20</span>,</span><br><span class="line">			text = text, </span><br><span class="line">			update_transform=<span class="literal">true</span>,</span><br><span class="line">			update_transform_rotation=<span class="literal">false</span>,</span><br><span class="line">			has_special_scale=<span class="literal">true</span>,</span><br><span class="line">			special_scale_x=<span class="number">0.65</span>,</span><br><span class="line">			special_scale_y=<span class="number">0.65</span>,</span><br><span class="line">			alpha=<span class="number">0.5</span>,</span><br><span class="line">		&#125;)		</span><br></pre></td></tr></table></figure></p>
<h3 id="EntityRemoveComponent"><a href="#EntityRemoveComponent" class="headerlink" title="EntityRemoveComponent"></a><code>EntityRemoveComponent</code></h3><blockquote>
<p>EntityRemoveComponent( entity_id:int, component_id:int )</p>
</blockquote>
<p>移除组件，输入实体id和组件id，无返回</p>
<h3 id="EntityGetAllComponents"><a href="#EntityGetAllComponents" class="headerlink" title="EntityGetAllComponents"></a><code>EntityGetAllComponents</code></h3><blockquote>
<p>EntityGetAllComponents( entity_id:int ) -&gt; {int} [Returns a table of component ids.]</p>
</blockquote>
<p>获取实体的全部组件，输入实体id返回一个组件id表</p>
<p>使用示例：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- hamis here is a entity_id</span></span><br><span class="line"><span class="keyword">for</span> _,comp <span class="keyword">in</span> <span class="built_in">pairs</span>(EntityGetAllComponents(hamis)) <span class="keyword">do</span></span><br><span class="line">     GamePrint(comp)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<h3 id="EntityGetComponent"><a href="#EntityGetComponent" class="headerlink" title="EntityGetComponent"></a><code>EntityGetComponent</code></h3><blockquote>
<p>EntityGetComponent( entity_id:int, component_type_name:string, tag:string = “” ) -&gt; {component_id}|nil</p>
</blockquote>
<p>获取特定组件，输入实体id，组件名，标签（可省略），返回一个组件id表</p>
<h3 id="EntityGetFirstComponent"><a href="#EntityGetFirstComponent" class="headerlink" title="EntityGetFirstComponent"></a><code>EntityGetFirstComponent</code></h3><blockquote>
<p>EntityGetFirstComponent( entity_id:int, component_type_name:string, tag:string = “” ) -&gt; component_id|nil</p>
</blockquote>
<p>获取第一个组件，输入实体id，组件名，标签（可省略），返回一个组件id</p>
<h3 id="EntityGetComponentIncludingDisabled"><a href="#EntityGetComponentIncludingDisabled" class="headerlink" title="EntityGetComponentIncludingDisabled"></a><code>EntityGetComponentIncludingDisabled</code></h3><blockquote>
<p>EntityGetComponentIncludingDisabled( entity_id:int, component_type_name:string, tag:string = “” ) -&gt; {component_id}|nil</p>
</blockquote>
<p>获取包含禁用的组件，输入实体id，组件名，标签（可省略），返回一个组件id表</p>
<h3 id="EntityGetFirstComponentIncludingDisabled"><a href="#EntityGetFirstComponentIncludingDisabled" class="headerlink" title="EntityGetFirstComponentIncludingDisabled"></a><code>EntityGetFirstComponentIncludingDisabled</code></h3><blockquote>
<p>EntityGetFirstComponentIncludingDisabled( entity_id:int, component_type_name:string, tag:string = “” ) -&gt; component_id|nil</p>
</blockquote>
<p>获取包含禁用的组件中的第一个，输入实体id，组件名，标签（可省略），返回一个组件id</p>
<h3 id="EntitySetComponentIsEnabled"><a href="#EntitySetComponentIsEnabled" class="headerlink" title="EntitySetComponentIsEnabled"></a><code>EntitySetComponentIsEnabled</code></h3><blockquote>
<p>EntitySetComponentIsEnabled( entity_id:int, component_id:int, is_enabled:bool )</p>
</blockquote>
<p>启用/禁用组件，输入实体id，组件id，和一个布尔值（启用/禁用）</p>
<h3 id="EntitySetComponentsWithTagEnabled"><a href="#EntitySetComponentsWithTagEnabled" class="headerlink" title="EntitySetComponentsWithTagEnabled"></a><code>EntitySetComponentsWithTagEnabled</code></h3><blockquote>
<p>EntitySetComponentsWithTagEnabled( entity_id:int, tag:string, enabled:bool )</p>
</blockquote>
<p>批量启用/禁用带特定标签的组件，输入实体id，标签名，启用/禁用</p>
<h3 id="EntityLoadToEntity"><a href="#EntityLoadToEntity" class="headerlink" title="EntityLoadToEntity"></a><code>EntityLoadToEntity</code></h3><blockquote>
<p>EntityLoadToEntity( filename:string, entity:int ) [Loads components from ‘filename’ to ‘entity’. Does not load tags and other stuff.]</p>
</blockquote>
<p>把一个文件的组件加载到一个实体上，输入文件路径和实体id，例（念动力踢击天赋）：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EntityLoadToEntity( <span class="string">&quot;data/entities/misc/perk_telekinesis.xml&quot;</span>, entity_who_picked )</span><br></pre></td></tr></table></figure><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- data/entities/misc/perk_telekinesis.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Entity</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;<span class="name">TelekinesisComponent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">TelekinesisComponent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">AudioLoopComponent</span></span></span><br><span class="line"><span class="tag">    <span class="attr">_tags</span>=<span class="string">&quot;sound_telekinesis_move&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">file</span>=<span class="string">&quot;data/audio/Desktop/misc.bank&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">event_name</span>=<span class="string">&quot;misc/telekinesis/object_move&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">volume_autofade_speed</span>=<span class="string">&quot;0.05&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="tag">&lt;/<span class="name">AudioLoopComponent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">AudioLoopComponent</span></span></span><br><span class="line"><span class="tag">    <span class="attr">_tags</span>=<span class="string">&quot;sound_telekinesis_hold&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">file</span>=<span class="string">&quot;data/audio/Desktop/misc.bank&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">event_name</span>=<span class="string">&quot;misc/telekinesis/hold&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">volume_autofade_speed</span>=<span class="string">&quot;0.05&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="tag">&lt;/<span class="name">AudioLoopComponent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Entity</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>随便替换组件会产生复杂的异常行为，有待进一步探索</p>
<h3 id="EntitySave"><a href="#EntitySave" class="headerlink" title="EntitySave"></a><code>EntitySave</code></h3><blockquote>
<p>EntitySave( entity_id:int, filename:string ) [Note: works only in dev builds.]</p>
</blockquote>
<p>保存实体为文件，输入实体id和保存到的文件路径，仅在开发者模式下可用   </p>
<h2 id="Component……"><a href="#Component……" class="headerlink" title="Component……"></a>Component……</h2><p>（从实体获取组件信息见实体部分）</p>
<h3 id="ComponentGetValue2"><a href="#ComponentGetValue2" class="headerlink" title="ComponentGetValue2"></a><code>ComponentGetValue2</code></h3><blockquote>
<p>ComponentGetValue2( component_id:int, field_name:string ) -&gt; multiple_types|nil [Returns one or many values matching the type or subtypes of the requested field. Reports error and returns nil if the field type is not supported or field was not found. This is up to 7.5x faster than the old ComponentSetValue functions.]</p>
</blockquote>
<p>获取组件的字段的值，输入组件id和字段名，返回匹配的所有值/nil</p>
<h3 id="ComponentSetValue2"><a href="#ComponentSetValue2" class="headerlink" title="ComponentSetValue2"></a><code>ComponentSetValue2</code></h3><blockquote>
<p>ComponentSetValue2( component_id:int, field_name:string, value_or_values:multiple_types ) [Sets the value of a field. Value(s) should have a type matching the field type. Reports error if the values weren’t given in correct type, the field type is not supported, or the component does not exist. This is up to 20x faster than the old ComponentSetValue functions.]</p>
</blockquote>
<p>设置组件字段，输入组件id，字段名，值。</p>
<h3 id="ComponentObjectGetValue2"><a href="#ComponentObjectGetValue2" class="headerlink" title="ComponentObjectGetValue2"></a><code>ComponentObjectGetValue2</code></h3><blockquote>
<p>ComponentObjectGetValue2( component_id:int, object_name:string, field_name:string ) -&gt; multiple types|nil [Returns one or many values matching the type or subtypes of the requested field in a component subobject. Reports error and returns nil if the field type is not supported or ‘object_name’ is not a metaobject.]</p>
</blockquote>
<p>获取object的值，输入组件id，对象名，字段名，返回值</p>
<p>一个组件的属性可能是标签，比如：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">DamageModelComponent</span> </span></span><br><span class="line"><span class="tag"><span class="attr">hp</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">max_hp</span>=<span class="string">&quot;50&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">materials_create_messages</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">ragdoll_filenames_file</span>=<span class="string">&quot;&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">fire_probability_of_ignition</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">ragdoll_fx_forced</span>=<span class="string">&quot;DISINTEGRATED&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">ragdoll_material</span>=<span class="string">&quot;rock_static_glow&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">minimum_knockback_force</span>=<span class="string">&quot;1000&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">materials_that_damage</span>=<span class="string">&quot;&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">materials_how_much_damage</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">damage_multipliers</span></span></span><br><span class="line"><span class="tag">	<span class="attr">melee</span>=<span class="string">&quot;0.3&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">projectile</span>=<span class="string">&quot;0.5&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">explosion</span>=<span class="string">&quot;1.0&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">electricity</span>=<span class="string">&quot;1.0&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">ice</span>=<span class="string">&quot;1.0&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">fire</span>=<span class="string">&quot;0.1&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">damage_multipliers</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">DamageModelComponent</span>&gt;</span></span><br></pre></td></tr></table></figure><br>获取深层标签(damage_multipliers)的值就可以用如下的方法：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> fire_damage = ComponentObjectGetValue2(comp_id, <span class="string">&quot;damage_multipliers&quot;</span>, <span class="string">&quot;fire&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="ComponentObjectSetValue2"><a href="#ComponentObjectSetValue2" class="headerlink" title="ComponentObjectSetValue2"></a><code>ComponentObjectSetValue2</code></h3><blockquote>
<p>ComponentObjectSetValue2( component_id:int, object_name:string, field_name:string, value_or_values:multiple_types ) [Sets the value of a field in a component subobject. Value(s) should have a type matching the field type. Reports error if the values weren’t given in correct type, the field type is not supported or ‘object_name’ is not a metaobject.]</p>
</blockquote>
<p>输入组件id，对象名，字段名，值，例：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ComponentObjectSetValue2(damagemodel_comp, <span class="string">&quot;damage_multipliers&quot;</span>, <span class="string">&quot;melee&quot;</span>, <span class="number">1.5</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="射线"><a href="#射线" class="headerlink" title="射线"></a>射线</h2><h3 id="Raytrace"><a href="#Raytrace" class="headerlink" title="Raytrace"></a><code>Raytrace</code></h3><blockquote>
<p>Raytrace( x1:number, y1:number, x2:number, y2:number ) -&gt; did_hit:bool,hit_x:number,hit_y:number [Does a raytrace that stops on any cell it hits.]</p>
</blockquote>
<p>输入两对坐标，返回一个bool值是否碰撞，以及碰撞位置的坐标</p>
<p>开销在 200次/ms 左右，也就是每帧1000不会导致卡顿，局部性良好的话可以更高</p>
<h3 id="RaytraceSurfaces"><a href="#RaytraceSurfaces" class="headerlink" title="RaytraceSurfaces"></a><code>RaytraceSurfaces</code></h3><blockquote>
<p>RaytraceSurfaces( x1:number, y1:number, x2:number, y2:number ) -&gt; did_hit:bool,hit_x:number,hit_y:number [Does a raytrace that stops on any cell that is not fluid, gas (yes, technically gas is a fluid), or fire.]</p>
</blockquote>
<p>输入输出同上，但是碰撞不包括液体、气体和火焰，开销和Raytrace基本一致</p>
<h3 id="RaytraceSurfacesAndLiquiform"><a href="#RaytraceSurfacesAndLiquiform" class="headerlink" title="RaytraceSurfacesAndLiquiform"></a><code>RaytraceSurfacesAndLiquiform</code></h3><blockquote>
<p>RaytraceSurfacesAndLiquiform( x1:number, y1:number, x2:number, y2:number ) -&gt; did_hit:bool,hit_x:number,hit_y:number [Does a raytrace that stops on any cell that is not gas or fire.]</p>
</blockquote>
<p>检测碰撞任何除气体和火焰之外的像素，几乎没有局部性时开销和Raytrace基本一致，局部性良好的话开销比Raytrace高</p>
<h3 id="RaytracePlatforms"><a href="#RaytracePlatforms" class="headerlink" title="RaytracePlatforms"></a><code>RaytracePlatforms</code></h3><blockquote>
<p>RaytracePlatforms( x1:number, y1:number, x2:number, y2:number ) -&gt; did_hit:bool,hit_x:number,hit_y:number [Does a raytrace that stops on any cell a character can stand on.]</p>
</blockquote>
<p>碰撞标准是像素可以站上去，开销略高Raytrace一点点</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/lua/">lua</a><a class="post-meta__tags" href="/tags/noita/">noita</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/07/28/CSAPP-%E7%AC%AC%E5%9B%9B%E7%AB%A0/" title="CSAPP-第四章"><img class="cover" src="/image/cover24_joy.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">CSAPP-第四章</div></div><div class="info-2"><div class="info-item-1">*4.45 在3.4.2节中，x86-64 pushq 指令被描述成要减少栈指针，然后将寄存器存储在栈指针的位置。因此，如果我们有一条指令形如对于某个寄存器 REG, pushq REG, 它等价千下面的代码序列：12subq $8,%rsp  Decrement stack pointermovq REG, (%rsp)  Store REG on stackA. 借助于练习题 4.7中所做的分析，这段代码序列正确地描述了指令 pushq %rsp 的行为吗？请解释。 B. 你该如何改写这段代码序列，使得它能够像对 REG 是其他寄存器时一样，正确地描述 REG 是%rsp 的情况？  正常来说入栈是栈指针下移，把值放到栈上，但是pushq %rsp时，如果真的有这行代码，存的值是下移前还是后就产生了歧义。4.7告诉我们存的是没有减小的栈指针，所以题目所给的汇编代码是不正确的 修改的话：12movq REG, (%rsp-8)subq $8,%rsp  *4.46 3.4.2节中， x86-64 popq...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/06/28/noita-mode-0/" title="noita_mode_0"><img class="cover" src="/image/cover14_soft.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-28</div><div class="info-item-2">noita_mode_0</div></div><div class="info-2"><div class="info-item-1">本文用于记录本人的第一个noita的mod开发过程 新建文件夹第一步，在mods文件夹下新建文件夹 一个模组至少包括两个文件，mod.xml和init.lua 关于.xml文件在pom.xml里已经被折磨过见过了，重新从头认识一下：eXtensible Markup Language，意为”可扩展标记语言”。 声明（可以没有，noita的文件都没有）：1&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; 交代编码方式 元素和属性元素用成对的标签包裹内容，属性附着在起始标签上提供附加信息，必须加引号 1234567891011&lt;Mod	name=&quot;Daily Practice Run&quot;	description=&quot;You can practice by replaying the same seed within 24...</div></div></div></a><a class="pagination-related" href="/2025/06/24/lua%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="lua学习笔记（持续更新中）"><img class="cover" src="/image/cover9_star.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-24</div><div class="info-item-2">lua学习笔记（持续更新中）</div></div><div class="info-2"><div class="info-item-1">🌙 前言开始之前先记录一下与lua的结缘过程：  Noita的法术编程系统是用lua写的，早就想从源码层面研究一下noita了 上学期cpp课老师建议我用lua给我的小游戏写个引擎 lua是葡萄牙语中”月亮“的意思，对美丽的名字没有任何抵抗力！ 听说了一些诸如某初中生在 nspire 上用lua 写东西的故事  总而言之，既c和cpp之后第三门认真学的语言（是的到现在py、js、java、html、asm还没认真学过）就这么愉快的决定了 环境在线运行环境：可以在网页里运行  windows解释器  把.exe文件所在目录添加到环境变量里即可 资料中文文档  语法 这语言还有王法吗？  Hello world1print(&quot;hello world&quot;) 和python一致 变量声明赋值就是声明，默认为全局变量（好极端），需要手动加local关键字 一切没声明的变量都是nil 支持多重赋值 1a,b = 1 ,2 数据类型 number: lua的数字只有一个类型，为c里的double，支持16进制表示、科学计数法、左移右移运算 string:...</div></div></div></a><a class="pagination-related" href="/2025/07/09/%E5%A4%8D%E6%9D%822d%E6%B8%B8%E6%88%8F%E5%9C%B0%E5%9B%BE%E4%B8%8A%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AF%BB%E8%B7%AF%E7%AE%97%E6%B3%95%E8%AE%BE%E8%AE%A1/" title="复杂2d游戏地图上的自动化寻路算法设计"><img class="cover" src="/image/cover18_spirit.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-09</div><div class="info-item-2">复杂2d游戏地图上的自动化寻路算法设计</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/auceptin-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Auceptin.Fang</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">welcome to my blog！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E7%9B%B8%E5%85%B3"><span class="toc-number">1.</span> <span class="toc-text">调试相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GamePrint"><span class="toc-number">1.1.</span> <span class="toc-text">GamePrint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GamePrintImportant"><span class="toc-number">1.2.</span> <span class="toc-text">GamePrintImportant</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GameGetRealWorldTimeSinceStarted"><span class="toc-number">1.3.</span> <span class="toc-text">GameGetRealWorldTimeSinceStarted()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GameGetFrameNum"><span class="toc-number">1.4.</span> <span class="toc-text">GameGetFrameNum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GameGetDateAndTimeUTC"><span class="toc-number">1.5.</span> <span class="toc-text">GameGetDateAndTimeUTC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GameGetDateAndTimeLocal"><span class="toc-number">1.6.</span> <span class="toc-text">GameGetDateAndTimeLocal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SetTimeOut"><span class="toc-number">1.7.</span> <span class="toc-text">SetTimeOut</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SetWorldSeed"><span class="toc-number">1.8.</span> <span class="toc-text">SetWorldSeed</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Random"><span class="toc-number">1.9.</span> <span class="toc-text">Random</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Randomf"><span class="toc-number">1.10.</span> <span class="toc-text">Randomf</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Entity%E2%80%A6%E2%80%A6"><span class="toc-number">2.</span> <span class="toc-text">Entity……</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityLoad"><span class="toc-number">2.1.</span> <span class="toc-text">EntityLoad</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityLoadEndGameItem"><span class="toc-number">2.2.</span> <span class="toc-text">EntityLoadEndGameItem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityKill"><span class="toc-number">2.3.</span> <span class="toc-text">EntityKill</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityCreateNew"><span class="toc-number">2.4.</span> <span class="toc-text">EntityCreateNew</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityLoadCameraBound"><span class="toc-number">2.5.</span> <span class="toc-text">EntityLoadCameraBound</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetWithTag"><span class="toc-number">2.6.</span> <span class="toc-text">EntityGetWithTag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetInRadius"><span class="toc-number">2.7.</span> <span class="toc-text">EntityGetInRadius</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetInRadiusWithTag"><span class="toc-number">2.8.</span> <span class="toc-text">EntityGetInRadiusWithTag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetClosest"><span class="toc-number">2.9.</span> <span class="toc-text">EntityGetClosest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetClosestWithTag"><span class="toc-number">2.10.</span> <span class="toc-text">EntityGetClosestWithTag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetWithName"><span class="toc-number">2.11.</span> <span class="toc-text">EntityGetWithName</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetTransform"><span class="toc-number">2.12.</span> <span class="toc-text">EntityGetTransform</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntitySetTransform"><span class="toc-number">2.13.</span> <span class="toc-text">EntitySetTransform</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityApplyTransform"><span class="toc-number">2.14.</span> <span class="toc-text">EntityApplyTransform</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetName"><span class="toc-number">2.15.</span> <span class="toc-text">EntityGetName</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntitySetName"><span class="toc-number">2.16.</span> <span class="toc-text">EntitySetName</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetTags"><span class="toc-number">2.17.</span> <span class="toc-text">EntityGetTags</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityAddTag"><span class="toc-number">2.18.</span> <span class="toc-text">EntityAddTag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityRemoveTag"><span class="toc-number">2.19.</span> <span class="toc-text">EntityRemoveTag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityHasTag"><span class="toc-number">2.20.</span> <span class="toc-text">EntityHasTag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetFilename"><span class="toc-number">2.21.</span> <span class="toc-text">EntityGetFilename</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntitiesGetMaxID"><span class="toc-number">2.22.</span> <span class="toc-text">EntitiesGetMaxID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetIsAlive"><span class="toc-number">2.23.</span> <span class="toc-text">EntityGetIsAlive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityAddComponent"><span class="toc-number">2.24.</span> <span class="toc-text">EntityAddComponent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityAddComponent2"><span class="toc-number">2.25.</span> <span class="toc-text">EntityAddComponent2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityRemoveComponent"><span class="toc-number">2.26.</span> <span class="toc-text">EntityRemoveComponent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetAllComponents"><span class="toc-number">2.27.</span> <span class="toc-text">EntityGetAllComponents</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetComponent"><span class="toc-number">2.28.</span> <span class="toc-text">EntityGetComponent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetFirstComponent"><span class="toc-number">2.29.</span> <span class="toc-text">EntityGetFirstComponent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetComponentIncludingDisabled"><span class="toc-number">2.30.</span> <span class="toc-text">EntityGetComponentIncludingDisabled</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityGetFirstComponentIncludingDisabled"><span class="toc-number">2.31.</span> <span class="toc-text">EntityGetFirstComponentIncludingDisabled</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntitySetComponentIsEnabled"><span class="toc-number">2.32.</span> <span class="toc-text">EntitySetComponentIsEnabled</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntitySetComponentsWithTagEnabled"><span class="toc-number">2.33.</span> <span class="toc-text">EntitySetComponentsWithTagEnabled</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntityLoadToEntity"><span class="toc-number">2.34.</span> <span class="toc-text">EntityLoadToEntity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EntitySave"><span class="toc-number">2.35.</span> <span class="toc-text">EntitySave</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Component%E2%80%A6%E2%80%A6"><span class="toc-number">3.</span> <span class="toc-text">Component……</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ComponentGetValue2"><span class="toc-number">3.1.</span> <span class="toc-text">ComponentGetValue2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ComponentSetValue2"><span class="toc-number">3.2.</span> <span class="toc-text">ComponentSetValue2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ComponentObjectGetValue2"><span class="toc-number">3.3.</span> <span class="toc-text">ComponentObjectGetValue2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ComponentObjectSetValue2"><span class="toc-number">3.4.</span> <span class="toc-text">ComponentObjectSetValue2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%84%E7%BA%BF"><span class="toc-number">4.</span> <span class="toc-text">射线</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Raytrace"><span class="toc-number">4.1.</span> <span class="toc-text">Raytrace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RaytraceSurfaces"><span class="toc-number">4.2.</span> <span class="toc-text">RaytraceSurfaces</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RaytraceSurfacesAndLiquiform"><span class="toc-number">4.3.</span> <span class="toc-text">RaytraceSurfacesAndLiquiform</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RaytracePlatforms"><span class="toc-number">4.4.</span> <span class="toc-text">RaytracePlatforms</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/29/noita-api/" title="noita_api"><img src="/image/cover25_sunshine.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="noita_api"/></a><div class="content"><a class="title" href="/2025/07/29/noita-api/" title="noita_api">noita_api</a><time datetime="2025-07-29T09:00:00.000Z" title="发表于 2025-07-29 17:00:00">2025-07-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/28/CSAPP-%E7%AC%AC%E5%9B%9B%E7%AB%A0/" title="CSAPP-第四章"><img src="/image/cover24_joy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CSAPP-第四章"/></a><div class="content"><a class="title" href="/2025/07/28/CSAPP-%E7%AC%AC%E5%9B%9B%E7%AB%A0/" title="CSAPP-第四章">CSAPP-第四章</a><time datetime="2025-07-28T04:50:13.000Z" title="发表于 2025-07-28 12:50:13">2025-07-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/11/OSTEP-%E7%AC%AC%E5%8D%81%E4%B9%9D%E7%AB%A0/" title="OSTEP-第十九章"><img src="/image/cover23_music.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OSTEP-第十九章"/></a><div class="content"><a class="title" href="/2025/07/11/OSTEP-%E7%AC%AC%E5%8D%81%E4%B9%9D%E7%AB%A0/" title="OSTEP-第十九章">OSTEP-第十九章</a><time datetime="2025-07-11T00:55:59.000Z" title="发表于 2025-07-11 08:55:59">2025-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/10/Docker%E4%B8%8ENAT/" title="Docker与NAT"><img src="/image/cover22_cat.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker与NAT"/></a><div class="content"><a class="title" href="/2025/07/10/Docker%E4%B8%8ENAT/" title="Docker与NAT">Docker与NAT</a><time datetime="2025-07-10T14:35:32.000Z" title="发表于 2025-07-10 22:35:32">2025-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/09/%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93%EF%BC%9A%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%81%8C%E4%B8%9A%E7%B4%A0%E5%85%BB/" title="代码整洁之道：程序员的职业素养"><img src="/image/cover21_blingbling.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="代码整洁之道：程序员的职业素养"/></a><div class="content"><a class="title" href="/2025/07/09/%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93%EF%BC%9A%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%81%8C%E4%B8%9A%E7%B4%A0%E5%85%BB/" title="代码整洁之道：程序员的职业素养">代码整洁之道：程序员的职业素养</a><time datetime="2025-07-09T15:09:11.000Z" title="发表于 2025-07-09 23:09:11">2025-07-09</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/foot.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2025 By Auceptin.Fang</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'AuceptinFang/blog',
      'data-repo-id': 'R_kgDOO_UAjA',
      'data-category-id': 'DIC_kwDOO_UAjM4Cr3mL',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>